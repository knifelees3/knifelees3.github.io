<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Mathematica export notebook into pdf files with table of contents and bookmarks | Zhaohua Tian's Web</title><meta name="author" content="Zhaohua Tian"><meta name="copyright" content="Zhaohua Tian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MathematicaI have been using Mathemtica to write notes. It’s really convenient to use notebook files because we can write  program, formular, figures and text in one file. However, not everyone uses M">
<meta property="og:type" content="article">
<meta property="og:title" content="Mathematica export notebook into pdf files with table of contents and bookmarks">
<meta property="og:url" content="https://knifelees3.github.io/2023/05/20/C_%E6%95%99%E7%A8%8B_MathematicaExportPDFwithTOC/index.html">
<meta property="og:site_name" content="Zhaohua Tian&#39;s Web">
<meta property="og:description" content="MathematicaI have been using Mathemtica to write notes. It’s really convenient to use notebook files because we can write  program, formular, figures and text in one file. However, not everyone uses M">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picblog/MMAtoPDFFiles.gif">
<meta property="article:published_time" content="2023-05-20T15:30:30.000Z">
<meta property="article:modified_time" content="2023-06-06T03:20:14.000Z">
<meta property="article:author" content="Zhaohua Tian">
<meta property="article:tag" content="Mathemtica">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picblog/MMAtoPDFFiles.gif"><link rel="shortcut icon" href="/upload/ket.png"><link rel="canonical" href="https://knifelees3.github.io/2023/05/20/C_%E6%95%99%E7%A8%8B_MathematicaExportPDFwithTOC/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7c4710045c846acddf6f6813e3d1fa3e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Mathematica export notebook into pdf files with table of contents and bookmarks',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-06 11:20:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/upload/ket.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">100</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/academatic/"><span> Academic</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/knifelees3/my_pictures/master/picblog/MMAtoPDFFiles.gif')"><nav id="nav"><span id="blog-info"><a href="/" title="Zhaohua Tian's Web"><span class="site-name">Zhaohua Tian's Web</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/academatic/"><span> Academic</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Mathematica export notebook into pdf files with table of contents and bookmarks</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-05-20T15:30:30.000Z" title="Created 2023-05-20 23:30:30">2023-05-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-06-06T03:20:14.000Z" title="Updated 2023-06-06 11:20:14">2023-06-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>6min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Mathematica export notebook into pdf files with table of contents and bookmarks"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Mathematica"><a href="#Mathematica" class="headerlink" title="Mathematica"></a>Mathematica</h1><p>I have been using Mathemtica to write notes. It’s really convenient to use notebook files because we can write  program, formular, figures and text in one file. However, not everyone uses Mathematica, If we want to share our notes with others, exporting nb files into pdf format is necessary.</p>
<p>In default, the generated pdf by Mathematica is relatively simple, and  there is no TOC or bookmarks in the generated pdf files. It will be very inconvenient to read if the notes are very long. I have searched on stack exchange, but it seems that there is no existing good solution. According to the <a target="_blank" rel="noopener" href="https://mathematica.stackexchange.com/questions/267897/how-to-export-pdf-with-bookmarks">question</a>, may be we can save the nb files into <code>tex</code>  format and then compile it into pdf, but (according to my experience) problem exists when the nb file is long and the formular is complicated.</p>
<p>Finally, I myself try to add bookmarks mannually. I use python to process the generated pdf files, what I want to realize can be summarized as follows:</p>
<ul>
<li>Using Mathematica: For a long notebook file, we directly generate the pdf files (<code>pdf file 1</code>) </li>
<li>Using Mathematica: Then I will extract the chapter/section information and  generate a pdf file (<code>pdf file 2</code>) containing the table of contents (with suitable pdf page numbers)</li>
<li>Using Python：Finally, I will use python to merge the two pdfs into <code>pdf file 3</code> and add bookmarks into this merged pdf (<code>pdf file 3</code>).</li>
</ul>
<p>It seems that the above process is cumbersome, but it can be automated by the program, and the operation is very simple. I will show an example:</p>
<p>Assuming that the notebook file to be processed is <code>test.nb</code>, then in Mathematica </p>
<p>(1) we just need run the following program to generate the helping files</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(*The notebook directory*)</span></span><br><span class="line"><span class="variable">fileDir</span> <span class="operator">=</span> </span><br><span class="line">  <span class="string">"./"</span><span class="operator">;</span></span><br><span class="line">  <span class="comment">(*The notebook file*)</span></span><br><span class="line"><span class="variable">fileNb</span> <span class="operator">=</span> <span class="string">"test.nb"</span><span class="operator">;</span></span><br><span class="line"><span class="variable">GenTOCtoPDFTZH</span><span class="punctuation">[</span><span class="variable">fileDir</span><span class="operator">,</span> <span class="variable">fileNb</span><span class="punctuation">]</span><span class="operator">;</span></span><br></pre></td></tr></table></figure>
<p><strong>NOTES:</strong></p>
<blockquote>
<p>By runing above Mathematica program, two pdf files will be generated (<code>pdf file 1</code>, <code>pdf file 2</code>).  Extra txt file names <code>test.txt</code> is also generated. In this txt file, information about the TOC are saved.</p>
</blockquote>
<p>(2)then we use the corresponding  python program (see appendix II) to generate the final pdf files.</p>
<p>If you don’t want to install python, I have also written a program with simple GUI and compiled it into  <a target="_blank" rel="noopener" href="https://github.com/knifelees3/ToolBox/releases/tag/v0.1.0-alpha">Exe format</a>. This can be directly run on windows. Original code can be found on <a target="_blank" rel="noopener" href="https://github.com/knifelees3/ToolBox/tree/main/PDFTOC">this</a> </p>
<p>the final pdf files will have toc and bookmarks:<br><img src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picblog/MMAtoPDFFiles.gif" alt=""></p>
<p>However, by using python, the original links in PDF will be lost, so you can’t jump into certain page by clicking the links, this is the problem of  the python package <code>PyPDF2</code>.</p>
<h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><h3 id="the-Mathematica-function"><a href="#the-Mathematica-function" class="headerlink" title="the Mathematica function"></a>the Mathematica function</h3><p>modefied from the <a target="_blank" rel="noopener" href="https://mathematica.stackexchange.com/questions/476/generating-a-table-of-contents">question</a><br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">*</span><span class="variable">helper</span> <span class="variable">file</span> <span class="variable">for</span> <span class="variable">creating</span> <span class="variable">cell</span><span class="operator">*</span><span class="punctuation">)</span></span><br><span class="line"><span class="variable">createCell</span><span class="punctuation">[</span><span class="type">text_</span><span class="operator">,</span><span class="type">tag_</span><span class="operator">,</span><span class="type">level_</span><span class="punctuation">]</span><span class="operator">:=</span><span class="built_in">Cell</span><span class="punctuation">[</span><span class="built_in">BoxData</span><span class="punctuation">[</span><span class="built_in">TagBox</span><span class="punctuation">[</span><span class="built_in">GridBox</span><span class="punctuation">[</span><span class="punctuation">{</span><span class="punctuation">{</span><span class="string">""</span><span class="operator">,</span><span class="variable">text</span><span class="operator">,</span><span class="built_in">CounterBox</span><span class="punctuation">[</span><span class="string">"Page"</span><span class="operator">,</span><span class="punctuation">{</span><span class="variable">bookUrl</span><span class="operator">,</span><span class="variable">tag</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="operator">,</span><span class="built_in">GridBoxAlignment</span><span class="operator">-&gt;</span><span class="punctuation">{</span><span class="string">"Columns"</span><span class="operator">-&gt;</span><span class="punctuation">{</span><span class="built_in">Left</span><span class="operator">,</span><span class="built_in">Left</span><span class="operator">,</span><span class="built_in">Right</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="operator">,</span><span class="built_in">GridBoxItemSize</span><span class="operator">-&gt;</span><span class="punctuation">{</span><span class="string">"Columns"</span><span class="operator">-&gt;</span><span class="punctuation">{</span><span class="number">2</span> <span class="variable">level</span><span class="operator">-</span><span class="number">1</span><span class="operator">,</span><span class="number">35</span><span class="operator">-</span><span class="number">2</span> <span class="variable">level</span><span class="operator">,</span><span class="number">5</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="operator">,</span><span class="string">"Grid"</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">,</span><span class="string">"Text"</span><span class="operator">,</span><span class="built_in">FontColor</span><span class="operator">-&gt;</span><span class="built_in">Blue</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="comment">(*helper file for creating cell version II*)</span></span><br><span class="line"><span class="variable">createCellPy</span><span class="punctuation">[</span><span class="type">text_</span><span class="operator">,</span><span class="type">tag_</span><span class="operator">,</span><span class="type">level_</span><span class="punctuation">]</span><span class="operator">:=</span><span class="built_in">Cell</span><span class="punctuation">[</span><span class="built_in">BoxData</span><span class="punctuation">[</span><span class="built_in">TagBox</span><span class="punctuation">[</span><span class="built_in">GridBox</span><span class="punctuation">[</span><span class="punctuation">{</span><span class="punctuation">{</span><span class="string">""</span><span class="operator">,</span><span class="variable">text</span><span class="operator">,</span><span class="string">";"</span><span class="operator">,</span><span class="variable">level</span><span class="operator">,</span><span class="string">";"</span><span class="operator">,</span><span class="built_in">CounterBox</span><span class="punctuation">[</span><span class="string">"Page"</span><span class="operator">,</span><span class="punctuation">{</span><span class="variable">bookUrl</span><span class="operator">,</span><span class="variable">tag</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="operator">,</span><span class="string">";"</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="operator">,</span><span class="built_in">GridBoxAlignment</span><span class="operator">-&gt;</span><span class="punctuation">{</span><span class="string">"Columns"</span><span class="operator">-&gt;</span><span class="punctuation">{</span><span class="built_in">Left</span><span class="operator">,</span><span class="built_in">Left</span><span class="operator">,</span><span class="built_in">Left</span><span class="operator">,</span><span class="built_in">Left</span><span class="operator">,</span><span class="built_in">Right</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="operator">,</span><span class="built_in">GridBoxItemSize</span><span class="operator">-&gt;</span><span class="punctuation">{</span><span class="string">"Columns"</span><span class="operator">-&gt;</span><span class="punctuation">{</span><span class="number">2</span> <span class="variable">level</span><span class="operator">-</span><span class="number">1</span><span class="operator">,</span><span class="number">35</span><span class="operator">-</span><span class="number">2</span> <span class="variable">level</span><span class="operator">,</span><span class="number">5</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="operator">,</span><span class="string">"Grid"</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">,</span><span class="string">"Text"</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">GenTOCtoPDFTZH</span><span class="punctuation">[</span><span class="type">fileDir_</span><span class="operator">,</span><span class="type">fileNb_</span><span class="punctuation">]</span><span class="operator">:=</span><span class="built_in">Block</span><span class="punctuation">[</span><span class="punctuation">{</span><span class="variable">typeList</span><span class="operator">,</span><span class="variable">filepdf</span><span class="operator">,</span><span class="variable">filepdfToc</span><span class="operator">,</span><span class="variable">filetxt</span><span class="operator">,</span><span class="variable">bookUrl</span><span class="operator">,</span><span class="variable">tocPDF</span><span class="operator">,</span><span class="variable">tocPy</span><span class="operator">,</span><span class="variable">book</span><span class="operator">,</span><span class="variable">fexp</span><span class="punctuation">}</span><span class="operator">,</span></span><br><span class="line"><span class="variable">typeList</span><span class="operator">=</span><span class="punctuation">{</span><span class="string">"Section"</span><span class="operator">,</span><span class="string">"Subsection"</span><span class="punctuation">}</span><span class="operator">;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">filepdf</span><span class="operator">=</span><span class="built_in">StringReplace</span><span class="punctuation">[</span><span class="variable">fileNb</span><span class="operator">,</span><span class="string">".nb"</span><span class="operator">-&gt;</span><span class="string">".pdf"</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">filepdfToc</span><span class="operator">=</span><span class="built_in">StringReplace</span><span class="punctuation">[</span><span class="variable">fileNb</span><span class="operator">,</span><span class="string">".nb"</span><span class="operator">-&gt;</span><span class="string">"Toc.pdf"</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">filetxt</span><span class="operator">=</span><span class="built_in">StringReplace</span><span class="punctuation">[</span><span class="variable">fileNb</span><span class="operator">,</span><span class="string">".nb"</span><span class="operator">-&gt;</span><span class="string">".txt"</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">bookUrl</span><span class="operator">=</span><span class="built_in">FileNameJoin</span><span class="punctuation">[</span><span class="punctuation">{</span><span class="variable">fileDir</span><span class="operator">,</span><span class="variable">fileNb</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">SetDirectory</span><span class="punctuation">[</span><span class="variable">fileDir</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">tocPDF</span><span class="operator">=</span><span class="built_in">CreateDocument</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">SelectionMove</span><span class="punctuation">[</span><span class="variable">tocPDF</span><span class="operator">,</span><span class="built_in">Before</span><span class="operator">,</span><span class="built_in">Notebook</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">NotebookWrite</span><span class="punctuation">[</span><span class="variable">tocPDF</span><span class="operator">,</span><span class="built_in">Cell</span><span class="punctuation">[</span><span class="string">"目录"</span><span class="operator">,</span><span class="string">"Text"</span><span class="operator">,</span><span class="number">20</span><span class="operator">,</span><span class="built_in">Blue</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">tocPy</span><span class="operator">=</span><span class="built_in">CreateDocument</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">book</span><span class="operator">=</span><span class="built_in">NotebookOpen</span><span class="punctuation">[</span><span class="variable">bookUrl</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">SetOptions</span><span class="punctuation">[</span><span class="variable">book</span><span class="operator">,</span><span class="built_in">ShowPageBreaks</span><span class="operator">-&gt;</span><span class="built_in">True</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="comment">(*iterate over cells to set tags and write lines to TOC*)</span></span><br><span class="line"><span class="built_in">Scan</span><span class="punctuation">[</span><span class="punctuation">(</span><span class="variable">counter</span><span class="punctuation">[</span><span class="type">#</span><span class="punctuation">]</span><span class="operator">=</span><span class="number">0</span><span class="punctuation">)</span><span class="operator">&amp;,</span><span class="variable">typeList</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">SelectionMove</span><span class="punctuation">[</span><span class="variable">book</span><span class="operator">,</span><span class="built_in">Before</span><span class="operator">,</span><span class="built_in">Notebook</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">SelectionMove</span><span class="punctuation">[</span><span class="variable">book</span><span class="operator">,</span><span class="built_in">Next</span><span class="operator">,</span><span class="built_in">Cell</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">While</span><span class="punctuation">[</span><span class="punctuation">(</span><span class="variable">cell</span><span class="operator">=</span><span class="built_in">NotebookRead</span><span class="punctuation">[</span><span class="variable">book</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">=!=</span><span class="punctuation">{</span><span class="punctuation">}</span><span class="operator">,</span><span class="built_in">If</span><span class="punctuation">[</span><span class="built_in">Length</span><span class="punctuation">[</span><span class="variable">cell</span><span class="punctuation">]</span><span class="operator">&gt;=</span><span class="number">2</span><span class="operator">,</span><span class="variable">type</span><span class="operator">=</span><span class="variable">cell</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">If</span><span class="punctuation">[</span><span class="built_in">MemberQ</span><span class="punctuation">[</span><span class="variable">typeList</span><span class="operator">,</span><span class="variable">type</span><span class="punctuation">]</span><span class="operator">,</span><span class="variable">counter</span><span class="punctuation">[</span><span class="variable">type</span><span class="punctuation">]</span><span class="operator">+=</span><span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">tag</span><span class="operator">=</span><span class="variable">type</span><span class="operator">&lt;&gt;</span><span class="built_in">ToString</span><span class="punctuation">[</span><span class="variable">counter</span><span class="punctuation">[</span><span class="variable">type</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">SetOptions</span><span class="punctuation">[</span><span class="built_in">NotebookSelection</span><span class="punctuation">[</span><span class="variable">book</span><span class="punctuation">]</span><span class="operator">,</span><span class="built_in">CellTags</span><span class="operator">-&gt;</span><span class="built_in">Union</span><span class="punctuation">[</span><span class="built_in">Flatten</span><span class="punctuation">[</span><span class="punctuation">{</span><span class="built_in">Options</span><span class="punctuation">[</span><span class="built_in">NotebookSelection</span><span class="punctuation">[</span><span class="variable">book</span><span class="punctuation">]</span><span class="operator">,</span><span class="built_in">CellTags</span><span class="punctuation">]</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">,</span><span class="variable">tag</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">SelectionMove</span><span class="punctuation">[</span><span class="variable">book</span><span class="operator">,</span><span class="built_in">All</span><span class="operator">,</span><span class="built_in">CellContents</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">NotebookWrite</span><span class="punctuation">[</span><span class="variable">tocPDF</span><span class="operator">,</span><span class="variable">createCell</span><span class="punctuation">[</span><span class="built_in">NotebookRead</span><span class="punctuation">[</span><span class="variable">book</span><span class="punctuation">]</span><span class="operator">,</span><span class="variable">tag</span><span class="operator">,</span><span class="built_in">Position</span><span class="punctuation">[</span><span class="variable">typeList</span><span class="operator">,</span><span class="variable">type</span><span class="punctuation">]</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NotebookWrite</span><span class="punctuation">[</span><span class="variable">tocPy</span><span class="operator">,</span><span class="variable">createCellPy</span><span class="punctuation">[</span><span class="built_in">NotebookRead</span><span class="punctuation">[</span><span class="variable">book</span><span class="punctuation">]</span><span class="operator">,</span><span class="variable">tag</span><span class="operator">,</span><span class="built_in">Position</span><span class="punctuation">[</span><span class="variable">typeList</span><span class="operator">,</span><span class="variable">type</span><span class="punctuation">]</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">SelectionMove</span><span class="punctuation">[</span><span class="variable">book</span><span class="operator">,</span><span class="built_in">Next</span><span class="operator">,</span><span class="built_in">Cell</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="comment">(*存储为txt文件*)</span></span><br><span class="line"><span class="variable">fexp</span><span class="operator">=</span><span class="built_in">FileNameJoin</span><span class="punctuation">[</span><span class="punctuation">{</span><span class="variable">fileDir</span><span class="operator">,</span><span class="variable">filetxt</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">FrontEndExecute</span><span class="punctuation">[</span><span class="built_in">FrontEndToken</span><span class="punctuation">[</span><span class="variable">tocPy</span><span class="operator">,</span><span class="string">"Save"</span><span class="operator">,</span><span class="punctuation">{</span><span class="variable">fexp</span><span class="operator">,</span><span class="string">"Text"</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="comment">(*存储笔记本文件为pdf文件供Python使用*)</span></span><br><span class="line"><span class="variable">fexp</span><span class="operator">=</span><span class="built_in">FileNameJoin</span><span class="punctuation">[</span><span class="punctuation">{</span><span class="variable">fileDir</span><span class="operator">,</span><span class="variable">filepdf</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">Export</span><span class="punctuation">[</span><span class="variable">fexp</span><span class="operator">,</span><span class="variable">book</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="comment">(*存储目录文件为pdf文件供Python使用*)</span></span><br><span class="line"><span class="variable">fexp</span><span class="operator">=</span><span class="built_in">FileNameJoin</span><span class="punctuation">[</span><span class="punctuation">{</span><span class="variable">fileDir</span><span class="operator">,</span><span class="variable">filepdfToc</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">Export</span><span class="punctuation">[</span><span class="variable">fexp</span><span class="operator">,</span><span class="variable">tocPDF</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="comment">(*关闭所有*)</span></span><br><span class="line"><span class="built_in">NotebookClose</span><span class="punctuation">[</span><span class="variable">book</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">NotebookClose</span><span class="punctuation">[</span><span class="variable">tocPDF</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">NotebookClose</span><span class="punctuation">[</span><span class="variable">tocPy</span><span class="punctuation">]</span><span class="operator">;</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment">(*<span class="comment">(*复制目录到目标笔记本*)</span></span></span><br><span class="line"><span class="comment">SelectionMove[tocPDF,All,Notebook];</span></span><br><span class="line"><span class="comment">data=NotebookRead[tocPDF];</span></span><br><span class="line"><span class="comment">SelectionMove[book,Before,Notebook];</span></span><br><span class="line"><span class="comment">NotebookWrite[book,Cell["目录","Text",20,Blue]];</span></span><br><span class="line"><span class="comment">NotebookWrite[book,NotebookRead[tocPDF]];*)</span></span><br><span class="line"><span class="comment">(*存储为txt文件供Python使用*)</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Python-program-to-generate-TOC"><a href="#Python-program-to-generate-TOC" class="headerlink" title="Python program to generate TOC"></a>Python program to generate TOC</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># we set the file name to be processed</span></span><br><span class="line"><span class="built_in">dir</span>=<span class="string">'./'</span></span><br><span class="line">fileName=<span class="string">'test'</span></span><br><span class="line">dele=<span class="number">0</span> <span class="comment"># 0代表删除，1代表不删除</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PyPDF2 <span class="keyword">import</span> PdfReader, PdfWriter</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment">#sys.path.insert(1, '') # 为了可以让python将当前文件夹加入环境变量</span></span><br><span class="line"></span><br><span class="line">os.chdir(<span class="built_in">dir</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filetxt=fileName+<span class="string">'.txt'</span></span><br><span class="line">filepdf=fileName+<span class="string">'.pdf'</span></span><br><span class="line">filepdfTOC=fileName+<span class="string">'Toc.pdf'</span></span><br><span class="line">filepdfout=fileName+<span class="string">'WithToc.pdf'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># read lines from txt</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filetxt,<span class="string">'r'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.read().split(<span class="string">";"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">numlines=<span class="built_in">int</span>(<span class="built_in">len</span>(lines)/<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">tit_list=[]</span><br><span class="line">level_list=[]</span><br><span class="line">page_list=[]</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(numlines):</span><br><span class="line">    tit_list.append(lines[<span class="number">3</span>*l].replace(<span class="string">"\t"</span>, <span class="string">""</span>).replace(<span class="string">"\n"</span>, <span class="string">""</span>))</span><br><span class="line">    level_list.append(lines[<span class="number">3</span>*l+<span class="number">1</span>].replace(<span class="string">"\t"</span>, <span class="string">""</span>).replace(<span class="string">"\n"</span>, <span class="string">""</span>))</span><br><span class="line">    page_list.append(lines[<span class="number">3</span>*l+<span class="number">2</span>].replace(<span class="string">"\t"</span>, <span class="string">""</span>).replace(<span class="string">"\n"</span>, <span class="string">""</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(tit_list)</span></span><br><span class="line"><span class="comment">#print(level_list)</span></span><br><span class="line"><span class="comment">#print(page_list)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># generate bookmarks</span></span><br><span class="line"></span><br><span class="line">reader_Main = PdfReader(filepdf)  <span class="comment"># open input</span></span><br><span class="line">reader_Toc = PdfReader(filepdfTOC)  <span class="comment"># open input</span></span><br><span class="line">writer = PdfWriter()  <span class="comment"># open output</span></span><br><span class="line"></span><br><span class="line">n_Main = <span class="built_in">len</span>(reader_Main.pages)</span><br><span class="line">n_Toc = <span class="built_in">len</span>(reader_Toc.pages)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_Toc):</span><br><span class="line">    writer.add_page(reader_Toc.pages[i])  <span class="comment"># insert page of TOC</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_Main):</span><br><span class="line">    writer.add_page(reader_Main.pages[i])  <span class="comment"># insert page of Main</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(numlines):</span><br><span class="line">    <span class="keyword">if</span> level_list[l]==<span class="string">"1"</span>:</span><br><span class="line">        par=writer.add_outline_item(tit_list[l], <span class="built_in">int</span>(page_list[l]), parent=<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">elif</span> level_list[l]==<span class="string">"2"</span>:</span><br><span class="line">        writer.add_outline_item(tit_list[l], <span class="built_in">int</span>(page_list[l]), parent=par)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filepdfout, <span class="string">"wb"</span>) <span class="keyword">as</span> fp:  <span class="comment"># creating result pdf JCT</span></span><br><span class="line">    writer.write(fp)  <span class="comment"># writing to result pdf JCT</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dele==<span class="number">0</span>:</span><br><span class="line">	<span class="comment"># Delete the mid files</span></span><br><span class="line">	os.remove(filepdf)</span><br><span class="line">	os.remove(filepdfTOC)</span><br><span class="line">	os.remove(filetxt)</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://knifelees3.github.io">Zhaohua Tian</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://knifelees3.github.io/2023/05/20/C_%E6%95%99%E7%A8%8B_MathematicaExportPDFwithTOC/">https://knifelees3.github.io/2023/05/20/C_%E6%95%99%E7%A8%8B_MathematicaExportPDFwithTOC/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Mathemtica/">Mathemtica</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picblog/MMAtoPDFFiles.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/09/09/E_%E7%89%A9%E7%90%86_%E8%8B%B1%E8%AF%AD%E5%86%99%E4%BD%9C%E9%87%8D%E7%82%B9%E8%AF%8D%E6%B1%87%E4%B8%8E%E7%9F%AD%E5%8F%A5/" title="英语写作重点短句和词汇示例收集"><img class="cover" src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picgoup/WrittingFigures.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">英语写作重点短句和词汇示例收集</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/22/C_%E6%95%99%E7%A8%8B_MPB%E8%AE%A1%E7%AE%97%E4%BA%8C%E7%BB%B4%E5%85%89%E5%AD%90%E6%99%B6%E4%BD%93%E8%83%BD%E5%B8%A6/" title="Meep教程(4) MPB计算光子晶体能带"><img class="cover" src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picgoup/DipoleNearGuideStructure.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Meep教程(4) MPB计算光子晶体能带</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/upload/ket.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Zhaohua Tian</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">100</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://www.zhihu.com/people/knife-lee-94"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">ZhaohuaTian's personal blog/个人小站</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Mathematica"><span class="toc-number">1.</span> <span class="toc-text">Mathematica</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Appendix"><span class="toc-number">1.1.</span> <span class="toc-text">Appendix</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#the-Mathematica-function"><span class="toc-number">1.1.1.</span> <span class="toc-text">the Mathematica function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-program-to-generate-TOC"><span class="toc-number">1.1.2.</span> <span class="toc-text">Python program to generate TOC</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/02/15/E_%E7%89%A9%E7%90%86_20YearsNanoOptics/" title="Sympoisum 20 Years Nano Optics Pioneer Interview Collections"><img src="https://mpl.mpg.de/fileadmin/_processed_/0/5/csm_MPL_Vahid_Sandoghdar_SCT_1343_4da3fea24f.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Sympoisum 20 Years Nano Optics Pioneer Interview Collections"/></a><div class="content"><a class="title" href="/2025/02/15/E_%E7%89%A9%E7%90%86_20YearsNanoOptics/" title="Sympoisum 20 Years Nano Optics Pioneer Interview Collections">Sympoisum 20 Years Nano Optics Pioneer Interview Collections</a><time datetime="2025-02-15T15:32:30.000Z" title="Created 2025-02-15 23:32:30">2025-02-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/E_%E7%89%A9%E7%90%86_%E6%97%8B%E8%BD%ACFrame%E4%B8%8B%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F%E7%9A%84%E8%A1%A8%E7%A4%BA/" title="旋转Frame下哈密顿量的表示"><img src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picgoup/WrittingFigures.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="旋转Frame下哈密顿量的表示"/></a><div class="content"><a class="title" href="/2025/01/17/E_%E7%89%A9%E7%90%86_%E6%97%8B%E8%BD%ACFrame%E4%B8%8B%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F%E7%9A%84%E8%A1%A8%E7%A4%BA/" title="旋转Frame下哈密顿量的表示">旋转Frame下哈密顿量的表示</a><time datetime="2025-01-17T12:29:30.000Z" title="Created 2025-01-17 20:29:30">2025-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/28/E_%E7%89%A9%E7%90%86_%E5%B8%B8%E8%A7%81%E5%8D%95%E5%85%89%E5%AD%90%E6%BA%90%E7%A7%8D%E7%B1%BB/" title="典型单光子源以及光子波形"><img src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picblog/Snipaste_2025-02-12_00-04-09.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="典型单光子源以及光子波形"/></a><div class="content"><a class="title" href="/2024/10/28/E_%E7%89%A9%E7%90%86_%E5%B8%B8%E8%A7%81%E5%8D%95%E5%85%89%E5%AD%90%E6%BA%90%E7%A7%8D%E7%B1%BB/" title="典型单光子源以及光子波形">典型单光子源以及光子波形</a><time datetime="2024-10-28T14:28:30.000Z" title="Created 2024-10-28 22:28:30">2024-10-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/05/E_%E7%89%A9%E7%90%86_%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E7%A7%91%E7%A0%94%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF/" title="如何减少科研中的错误"><img src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picgoup/WrittingFigures.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何减少科研中的错误"/></a><div class="content"><a class="title" href="/2024/09/05/E_%E7%89%A9%E7%90%86_%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E7%A7%91%E7%A0%94%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF/" title="如何减少科研中的错误">如何减少科研中的错误</a><time datetime="2024-09-05T01:26:30.000Z" title="Created 2024-09-05 09:26:30">2024-09-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/05/E_%E7%89%A9%E7%90%86_%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E7%9A%84%E6%A3%80%E6%9F%A5%E6%96%87%E7%AB%A0%E4%BB%A5%E5%8F%8A%E6%8A%A5%E5%91%8A/" title="如何减少科研中的错误"><img src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picgoup/WrittingFigures.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何减少科研中的错误"/></a><div class="content"><a class="title" href="/2024/09/05/E_%E7%89%A9%E7%90%86_%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E7%9A%84%E6%A3%80%E6%9F%A5%E6%96%87%E7%AB%A0%E4%BB%A5%E5%8F%8A%E6%8A%A5%E5%91%8A/" title="如何减少科研中的错误">如何减少科研中的错误</a><time datetime="2024-09-05T01:26:30.000Z" title="Created 2024-09-05 09:26:30">2024-09-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Zhaohua Tian</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'jR8sBuhmF2OQvpAqh8LWCbt1-gzGzoHsz',
      appKey: '2C5ChxH3zGFNoQ8rO7u9I2Lb',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>