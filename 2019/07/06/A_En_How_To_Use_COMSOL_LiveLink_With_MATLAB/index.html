<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>How to use COMSOL, MATLAB and COMSOL livelink with MATLAB on Server | Zhaohua Tian's Web</title><meta name="author" content="Zhaohua Tian"><meta name="copyright" content="Zhaohua Tian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MATLAB #COMSOL #Livelink #Server[TOC] This note is to show the way of using MATLAB, COMSOL,COMSOL Livelink With MATLAB on our server   (ubuntu). We hope that we can run them with bash code in backgrou">
<meta property="og:type" content="article">
<meta property="og:title" content="How to use COMSOL, MATLAB and COMSOL livelink with MATLAB on Server">
<meta property="og:url" content="https://knifelees3.github.io/2019/07/06/A_En_How_To_Use_COMSOL_LiveLink_With_MATLAB/index.html">
<meta property="og:site_name" content="Zhaohua Tian&#39;s Web">
<meta property="og:description" content="MATLAB #COMSOL #Livelink #Server[TOC] This note is to show the way of using MATLAB, COMSOL,COMSOL Livelink With MATLAB on our server   (ubuntu). We hope that we can run them with bash code in backgrou">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/knifelees3/my_pictures/master/icons/COMSOLICON.png">
<meta property="article:published_time" content="2019-07-06T09:17:32.000Z">
<meta property="article:modified_time" content="2023-04-20T12:35:16.000Z">
<meta property="article:author" content="Zhaohua Tian">
<meta property="article:tag" content="COMSOL">
<meta property="article:tag" content="MATLAB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/knifelees3/my_pictures/master/icons/COMSOLICON.png"><link rel="shortcut icon" href="/upload/ket.png"><link rel="canonical" href="https://knifelees3.github.io/2019/07/06/A_En_How_To_Use_COMSOL_LiveLink_With_MATLAB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7c4710045c846acddf6f6813e3d1fa3e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'How to use COMSOL, MATLAB and COMSOL livelink with MATLAB on Server',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-20 20:35:16'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/upload/ket.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">101</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/academatic/"><span> Academic</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/knifelees3/my_pictures/master/icons/COMSOLICON.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Zhaohua Tian's Web"><span class="site-name">Zhaohua Tian's Web</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/academatic/"><span> Academic</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">How to use COMSOL, MATLAB and COMSOL livelink with MATLAB on Server</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2019-07-06T09:17:32.000Z" title="Created 2019-07-06 17:17:32">2019-07-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-04-20T12:35:16.000Z" title="Updated 2023-04-20 20:35:16">2023-04-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/EnglishNotes/">EnglishNotes</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">1.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>9min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="How to use COMSOL, MATLAB and COMSOL livelink with MATLAB on Server"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MATLAB-COMSOL-Livelink-Server"><a href="#MATLAB-COMSOL-Livelink-Server" class="headerlink" title="MATLAB #COMSOL #Livelink #Server"></a>MATLAB #COMSOL #Livelink #Server</h1><p>[TOC]</p>
<p>This note is to show the way of using MATLAB, COMSOL,COMSOL Livelink With MATLAB on our server   (ubuntu). We hope that we can run them with bash code in background and after we logout or exit the server the simulations will continue. We also need to know the simulation progress from a log file. These needs can all be satisfied only if you write proper bash code.</p>
<h2 id="Run-COMSOL-on-server"><a href="#Run-COMSOL-on-server" class="headerlink" title="Run COMSOL on server"></a>Run COMSOL on server</h2><p>If you want to run COMSOL on server, you can use the command of the following form</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> comsol batch -inputfile &lt;inputfilename&gt; -outputfile &lt;outputfilename&gt; -batchlog &lt;logfilename&gt; -np &lt;number of cores&gt; &amp;</span><br></pre></td></tr></table></figure>
<p>above command shows the smallest example and  the “&lt; &gt;” isn’t included in the actual terminal command. The form <code>nohup &lt;command&gt; &amp;</code> is used to execute the command in the background even if we logout from the server. To avoid confusion, I give a more specific example, If we want to simulate the file “test.mph”, then the command should be as follows</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> comsol batch -inputfile test.mph -outputfile test_out.mph -batchlog test.log -np 30 &amp;</span><br></pre></td></tr></table></figure>
<p>In above example we  use 30 cores (set with “-np 30”)to simulate our mph file. If we have many mph files to simulate, we can write a bash code to arrange our simulation works. We create a file with the name “comsolscript.sh” with the following content</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="built_in">nohup</span> comsol batch -inputfile test1.mph -outputfile test1_out.mph -batchlog test1.log -np 30 &amp;&amp;</span><br><span class="line"><span class="built_in">nohup</span> comsol batch -inputfile test2.mph -outputfile test2_out.mph -batchlog test2.log -np 30 &amp;&amp;</span><br><span class="line"><span class="built_in">nohup</span> comsol batch -inputfile test3.mph -outputfile test3_out.mph -batchlog test3.log -np 30 &amp;</span><br></pre></td></tr></table></figure>
<p>Above code will simulate the file “test1.mph”, “test2.mph”, “test3.mph” respectively. The “&amp;&amp;” at the end of the line will let the server to execute the next command only when this command complete. if you use “&amp;” then all the mission will simultaneously execute. You need upload the “comsolscript.sh” file to the correct folder and make it executable</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x ./comsolscript.sh</span><br></pre></td></tr></table></figure>
<p>then in the corresponding folder type</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./comsolscript.sh</span><br></pre></td></tr></table></figure>
<p>The simulation will begin and you can see the progress from the log file by typing <code>vi test.log</code>.</p>
<p>If you write the bash code on windows then upload the file to the server, when you try to run the bash file there may be error: “<code>/bin/bash^M:bad interpreter:No such file or directory</code>“, this is because of the difference of coding in Unix and Windows. You can use the following command in the corresponding folder to fix it</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./comsolscrpt.sh</span><br></pre></td></tr></table></figure>
<p>if you use vi on the server to create the bash file, this error can also be avoided.</p>
<h2 id="Run-MATLAB-on-server"><a href="#Run-MATLAB-on-server" class="headerlink" title="Run MATLAB on server"></a>Run MATLAB on server</h2><p>Before using the MATLAB on server, you need make sure that the matlab is in the system enviroment path. The method of adding the MATLAB path to the system enviroemnt can be found from my another note <a href="https://knifelees3.github.io/2020/01/01/C_%E6%95%99%E7%A8%8B_Ubuntu_%E5%AE%89%E8%A3%85COMSOL_MATLAB_FDTD%20Solutions/">Ubuntu安装COMSOL,MATLAB以及FDTD Solutions</a>.</p>
<p>If you want to run matlab without displaying the desktop, you can type</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">matlab -nodekstop -nosplash -nojvm</span><br></pre></td></tr></table></figure>
<p>If you want to run a file in the background, you can type the following command</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> matlab -nodesktop -nosplash -nojvm &lt;test.m&gt; progress.txt &amp;</span><br></pre></td></tr></table></figure>
<p><strong>Be carefuly that the <code>&lt;&gt;</code> is needed in MATLAB command!</strong> Above code run the  “test.m” in the background and save the screen display into the file “progress.txt”, so we can know the progress from the file. “-nojvm” is used to hide the plot progress if you don’t want to see the plot during the simulation. When the simulation meets some problems, there will be a “nohup.out”  file to show the error information.</p>
<p>A better choice is to use a bash file “matlabscript.sh” to run the corresponding MATLAB file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line">matlab -nodesktop -nosplash -nojvm &lt;test1.m;test2.test3.m;<span class="built_in">exit</span>;&gt; progress.txt</span><br></pre></td></tr></table></figure>
<p>Above bash file doesn’t use the “nohup command &amp;” and it will not run in the background. If you want to run in the background, you can type</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> ./matlabscript.sh &amp;</span><br></pre></td></tr></table></figure>
<p>The “exit” is important and if not after the simulation the MATLAB will be still alive in the background, then you need kill the MATLAB by typing <code>kill &lt;pid of MATLAB progress&gt;</code>.</p>
<h2 id="Run-COMSOL-live-link-with-MATLAB-on-server"><a href="#Run-COMSOL-live-link-with-MATLAB-on-server" class="headerlink" title="Run COMSOL live link with MATLAB on server"></a>Run COMSOL live link with MATLAB on server</h2><p>The usage of COMSOL live link with MATLAB can be found on the installation folder of COMSOL, the detailed usage is in the file “LiveLinkForMATLABUsersGuide.pdf”.</p>
<p>If you can use the graphics window, then you can run a MATLAB file “test.m” to run a COMSOL file by typing</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">comsol mphserver matlab <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>You can also run the script in batch without the MATLAB desktop and the MATLAB splash screen. Enter this command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">comsol mphserver matlab <span class="built_in">test</span> -nodesktop -mlnosplash</span><br></pre></td></tr></table></figure>
<p>However, if you want to run the script in the background, you can not just simply add a “nohup+command+&amp;”, I don’t know the reason. From the “LiveLinkForMATLABUsersGuide.pdf”, we can see the following words</p>
<blockquote>
<p>To connect COMSOL with a MATLAB terminal requires that xterm is installed on the machine. If this is not the case as it might be for a computation COMSOL server, a workaround is to connect manually MATLAB to a COMSOL server with the function <em>mphstart</em>.</p>
</blockquote>
<p>After trying for a while I finally know how to run the COMSOL livelink with MATLAB in the background on server. We need to create four files named “matlab_exe.m”,”test.m”,”comsolscript.sh”,”test.mph”.</p>
<ul>
<li>“test.mph” is the COMSOL file you want to simulate.</li>
<li>“test.m” is the file to run “test.mph” from MATLAB.</li>
<li>“matlab_exe.m” is used to link the MATLAB with COMSOL mphserver and run the “test.m” file and finally exit MATLAB.</li>
<li>“comsolscript.sh” is the bash code to open the COMSOL mphserver and run the file “matlab_exe.m”<br>the following is the detailed code.</li>
</ul>
<p><strong>For “matlab_exe.m”</strong></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% This code is to connect to the COMSOL livelink with MATLAB server</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% add the livelink path to the server for comsol5.4</span></span><br><span class="line">addpath(<span class="string">'/usr/local/comsol54/multiphysics/mli/'</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">% connect to the server, the default port number is 2036 and then 2037 ...</span></span><br><span class="line">mphstart(<span class="number">2036</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">% the MATLAB file you want to run</span></span><br><span class="line">test;</span><br><span class="line"></span><br><span class="line"><span class="comment">% exit the program</span></span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>
<p><strong>For “comsolscript.sh”</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="comment"># if the run the file and getting the error "/bin/bash^M:bad interpreter:No such file or directory",you can use </span></span><br><span class="line"><span class="comment"># the following command in the corresponding cluster to fix it</span></span><br><span class="line"><span class="comment"># sed -i -e 's/\r$//' scriptname.sh</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># this is to run the MATLAB file in script</span></span><br><span class="line"><span class="comment"># First start the COMSOL livelink with MATLAB for 5.4</span></span><br><span class="line"><span class="comment"># use "np" to define the number of cores you will use</span></span><br><span class="line">comsol54 mphserver -np 28 -silent &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># run the MATLAB file</span></span><br><span class="line"><span class="comment"># The "screenout.txt" will store the screen output for MATLAB</span></span><br><span class="line">matlab -nodesktop -nosplash  &lt;matlab_exe.m&gt; screenout.txt</span><br></pre></td></tr></table></figure>
<p><strong>For “test.m”</strong></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% save the COMSOLcprogress file as "COMSOL_Progress.txt" during simulations</span></span><br><span class="line">clear;clc;</span><br><span class="line">import com.comsol.model.*</span><br><span class="line">import com.comsol.model.util.*</span><br><span class="line">ModelUtil.showProgress(<span class="string">'COMSOL_Progress.txt'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">% other command</span></span><br><span class="line"><span class="comment">%........</span></span><br></pre></td></tr></table></figure>
<h2 id="Updated-Run-COMSOL-live-link-with-MATLAB-on-server-II"><a href="#Updated-Run-COMSOL-live-link-with-MATLAB-on-server-II" class="headerlink" title="Updated: Run COMSOL live link with MATLAB on server II"></a>Updated: Run COMSOL live link with MATLAB on server II</h2><p>The previous method needs four files which  seems too complicated. Actually we can just use three files, the matlab_exe.m can be casted into MATLAB files.</p>
<ul>
<li>“test.mph” is the COMSOL file you want to simulate.</li>
<li>“test.m” is the file to run “test.mph” from MATLAB.</li>
<li>“comsolscript.sh” is the bash code to open the COMSOL mphserver and run the file “matlab_exe.m”<br>the following is the detailed code.</li>
</ul>
<p><strong>For “matlab_exe.m”</strong></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% This code is to connect to the COMSOL livelink with MATLAB server</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% add the livelink path to the server for comsol5.4</span></span><br><span class="line">addpath(<span class="string">'/usr/local/comsol54/multiphysics/mli/'</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">% connect to the server, the default port number is 2036 and then 2037 ...</span></span><br><span class="line">mphstart(<span class="number">2036</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">% the MATLAB file you want to run</span></span><br><span class="line">test;</span><br><span class="line"></span><br><span class="line"><span class="comment">% exit the program</span></span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>
<p><strong>For “comsolscript.sh”</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="comment"># if the run the file and getting the error "/bin/bash^M:bad interpreter:No such file or directory",you can use </span></span><br><span class="line"><span class="comment"># the following command in the corresponding cluster to fix it</span></span><br><span class="line"><span class="comment"># sed -i -e 's/\r$//' scriptname.sh</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># this is to run the MATLAB file in script</span></span><br><span class="line"><span class="comment"># First start the COMSOL livelink with MATLAB for 5.4</span></span><br><span class="line"><span class="comment"># use "np" to define the number of cores you will use</span></span><br><span class="line">comsol54 mphserver -np 28 -silent &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># run the MATLAB file</span></span><br><span class="line"><span class="comment"># The "screenout.txt" will store the screen output for MATLAB</span></span><br><span class="line">matlab -nodesktop -nosplash  &lt;matlab_exe.m&gt; screenout.txt</span><br></pre></td></tr></table></figure>
<p><strong>For “test.m”</strong></p>
<p>```matlab<br>% This code is to connect to the COMSOL livelink with MATLAB server</p>
<p>% add the livelink path to the server for comsol5.4<br>addpath(‘/usr/local/comsol54/multiphysics/mli/‘); </p>
<p>% connect to the server, the default port number is 2036 and then 2037 …<br>mphstart(2036)</p>
<p>% save the COMSOLcprogress file as “COMSOL_Progress.txt” during simulations<br>clear;clc;<br>import com.comsol.model.<em><br>import com.comsol.model.util.</em><br>ModelUtil.showProgress(‘COMSOL_Progress.txt’);</p>
<p>% other command<br>%……..</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://knifelees3.github.io">Zhaohua Tian</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://knifelees3.github.io/2019/07/06/A_En_How_To_Use_COMSOL_LiveLink_With_MATLAB/">https://knifelees3.github.io/2019/07/06/A_En_How_To_Use_COMSOL_LiveLink_With_MATLAB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/COMSOL/">COMSOL</a><a class="post-meta__tags" href="/tags/MATLAB/">MATLAB</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/knifelees3/my_pictures/master/icons/COMSOLICON.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/07/23/A_En_Python_PlotStudy1_SemiCircle_OscilatorApprox/" title="Python Plot (1) A small ball on a smooth semicircle (Animated)"><img class="cover" src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/20190723_Oscilator/pi_6.gif" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Python Plot (1) A small ball on a smooth semicircle (Animated)</div></div></a></div><div class="next-post pull-right"><a href="/2019/07/02/C_%E6%95%99%E7%A8%8B_%E7%94%A8RevTex%E6%8A%95%E7%A8%BFAPS%E7%9A%84%E8%AE%B0%E5%BD%95/" title="APS用RevTex投稿全记录"><img class="cover" src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/icons/EndNoteICON.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">APS用RevTex投稿全记录</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2020/07/06/A_En-COMSOL-Installation/" title="Installation of COMSOL"><img class="cover" src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/icons/COMSOLICON.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-06</div><div class="title">Installation of COMSOL</div></div></a></div><div><a href="/2020/07/06/A_En-COMSOL-Use-on-Server/" title="How to use COMSOL on server"><img class="cover" src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/icons/COMSOLICON.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-06</div><div class="title">How to use COMSOL on server</div></div></a></div><div><a href="/2020/07/06/A_En_Local-COMSOL-ProblemList&Solutions/" title="COMSOL Problem List and Solutions"><img class="cover" src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/icons/COMSOLICON.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-06</div><div class="title">COMSOL Problem List and Solutions</div></div></a></div><div><a href="/2020/08/20/A_En_PlaneWaveInputDirectionsViaPort/" title="Direction in port-Plane wave input via port in COMSOL"><img class="cover" src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picgoup/InputDirections.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-20</div><div class="title">Direction in port-Plane wave input via port in COMSOL</div></div></a></div><div><a href="/2020/08/20/A_En__Plane-Wave-Transmission-and-Its-Relization-in-COMSOL/" title="Plane wave&#39;s transmission in a substate structure and its theoretical realization in COMSOL"><img class="cover" src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picgoup/20200220133639360_19041.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-20</div><div class="title">Plane wave&#39;s transmission in a substate structure and its theoretical realization in COMSOL</div></div></a></div><div><a href="/2020/02/21/C_%E6%95%99%E7%A8%8B-%E4%BB%8ECOMSOL%E7%9A%84log%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E8%BF%90%E7%AE%97%E6%97%B6%E9%97%B4%E5%92%8C%E5%86%85%E5%AD%98/" title="从COMSOL的log文件读取运算时间和内存并绘图"><img class="cover" src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picgoup/20200221-simulation-time-memory.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-02-21</div><div class="title">从COMSOL的log文件读取运算时间和内存并绘图</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/upload/ket.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Zhaohua Tian</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">101</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://www.zhihu.com/people/knife-lee-94"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">ZhaohuaTian's personal blog/个人小站</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MATLAB-COMSOL-Livelink-Server"><span class="toc-number">1.</span> <span class="toc-text">MATLAB #COMSOL #Livelink #Server</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Run-COMSOL-on-server"><span class="toc-number">1.1.</span> <span class="toc-text">Run COMSOL on server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run-MATLAB-on-server"><span class="toc-number">1.2.</span> <span class="toc-text">Run MATLAB on server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run-COMSOL-live-link-with-MATLAB-on-server"><span class="toc-number">1.3.</span> <span class="toc-text">Run COMSOL live link with MATLAB on server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Updated-Run-COMSOL-live-link-with-MATLAB-on-server-II"><span class="toc-number">1.4.</span> <span class="toc-text">Updated: Run COMSOL live link with MATLAB on server II</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/14/E_%E7%89%A9%E7%90%86_%E9%9D%9E%E6%AD%A3%E4%BA%A4%E5%9F%BA%E7%9F%A2%E5%B1%95%E5%BC%80%E7%9A%84%E6%96%B9%E6%B3%95/" title="如何正确使用非正交基矢展开某个矢量"><img src="https://en.wikipedia.org/wiki/File:Orthogonality_and_rotation.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何正确使用非正交基矢展开某个矢量"/></a><div class="content"><a class="title" href="/2025/09/14/E_%E7%89%A9%E7%90%86_%E9%9D%9E%E6%AD%A3%E4%BA%A4%E5%9F%BA%E7%9F%A2%E5%B1%95%E5%BC%80%E7%9A%84%E6%96%B9%E6%B3%95/" title="如何正确使用非正交基矢展开某个矢量">如何正确使用非正交基矢展开某个矢量</a><time datetime="2025-09-14T05:15:30.000Z" title="Created 2025-09-14 13:15:30">2025-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/15/E_%E7%89%A9%E7%90%86_20YearsNanoOptics/" title="Sympoisum 20 Years Nano Optics Pioneer Interview Collections"><img src="https://mpl.mpg.de/fileadmin/_processed_/b/b/csm_csm_PosterNanoOptics_1205_b3e9b30b98_8bd88f2d16.gif" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Sympoisum 20 Years Nano Optics Pioneer Interview Collections"/></a><div class="content"><a class="title" href="/2025/02/15/E_%E7%89%A9%E7%90%86_20YearsNanoOptics/" title="Sympoisum 20 Years Nano Optics Pioneer Interview Collections">Sympoisum 20 Years Nano Optics Pioneer Interview Collections</a><time datetime="2025-02-15T15:32:30.000Z" title="Created 2025-02-15 23:32:30">2025-02-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/E_%E7%89%A9%E7%90%86_%E6%97%8B%E8%BD%ACFrame%E4%B8%8B%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F%E7%9A%84%E8%A1%A8%E7%A4%BA/" title="旋转Frame下哈密顿量的表示"><img src="https://ars.els-cdn.com/content/image/1-s2.0-S1470180402800037-gr2.gif" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="旋转Frame下哈密顿量的表示"/></a><div class="content"><a class="title" href="/2025/01/17/E_%E7%89%A9%E7%90%86_%E6%97%8B%E8%BD%ACFrame%E4%B8%8B%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F%E7%9A%84%E8%A1%A8%E7%A4%BA/" title="旋转Frame下哈密顿量的表示">旋转Frame下哈密顿量的表示</a><time datetime="2025-01-17T12:29:30.000Z" title="Created 2025-01-17 20:29:30">2025-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/28/E_%E7%89%A9%E7%90%86_%E5%B8%B8%E8%A7%81%E5%8D%95%E5%85%89%E5%AD%90%E6%BA%90%E7%A7%8D%E7%B1%BB/" title="典型单光子源以及光子波形"><img src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picblog/Snipaste_2025-02-12_00-04-09.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="典型单光子源以及光子波形"/></a><div class="content"><a class="title" href="/2024/10/28/E_%E7%89%A9%E7%90%86_%E5%B8%B8%E8%A7%81%E5%8D%95%E5%85%89%E5%AD%90%E6%BA%90%E7%A7%8D%E7%B1%BB/" title="典型单光子源以及光子波形">典型单光子源以及光子波形</a><time datetime="2024-10-28T14:28:30.000Z" title="Created 2024-10-28 22:28:30">2024-10-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/05/E_%E7%89%A9%E7%90%86_%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E7%A7%91%E7%A0%94%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF/" title="如何减少科研中的错误"><img src="https://raw.githubusercontent.com/knifelees3/my_pictures/master/picgoup/WrittingFigures.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何减少科研中的错误"/></a><div class="content"><a class="title" href="/2024/09/05/E_%E7%89%A9%E7%90%86_%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E7%A7%91%E7%A0%94%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF/" title="如何减少科研中的错误">如何减少科研中的错误</a><time datetime="2024-09-05T01:26:30.000Z" title="Created 2024-09-05 09:26:30">2024-09-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Zhaohua Tian</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'jR8sBuhmF2OQvpAqh8LWCbt1-gzGzoHsz',
      appKey: '2C5ChxH3zGFNoQ8rO7u9I2Lb',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>